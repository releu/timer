<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <style type="text/css">
            html, body {
                height: 100%;
            }

            body {
                margin: 0;
                padding: 0;
                background: white;
                color: white;
                font-family: "YS Text", sans-serif;
            }

            .container {
                height: 100%;
                position: relative;
                display: flex;
                justify-content: space-around;
                user-select: none;
                background: white;
            }

            .controls {
                align-self: center;
            }

            .controls__row {
                display: flex;
            }

            .controls__item {
                width: 25vw;
                height: 25vh;
                position: relative;
            }

            .controls__item + .controls__item {
                margin-left: 1vw
            }

            .controls__row + .controls__row {
                margin-top: 1vh
            }

            .timer {
                position: fixed;
                display: flex;
                justify-content: space-around;
                background: black;
                cursor: pointer;
                transition: transform ease-out 200ms;
                display: none;
            }

            .controls__row:nth-child(1) .controls__item:nth-child(1) .timer {
                left: 11.5vw;
                right: 63.5vw;
                top: 24.5vh;
                bottom: 50.5vh;
                display: flex;
            }

            .controls__row:nth-child(1) .controls__item:nth-child(2) .timer {
                left: 37.5vw;
                right: 37.5vw;
                top: 24.5vh;
                bottom: 50.5vh;
                display: flex;
            }

            .controls__row:nth-child(1) .controls__item:nth-child(3) .timer {
                left: 63.5vw;
                right: 11.5vw;
                top: 24.5vh;
                bottom: 50.5vh;
                display: flex;
            }

            .controls__row:nth-child(2) .controls__item:nth-child(1) .timer {
                left: 11.5vw;
                right: 63.5vw;
                top: 50.5vh;
                bottom: 24.5vh;
                display: flex;
            }

            .controls__row:nth-child(2) .controls__item:nth-child(2) .timer {
                left: 37.5vw;
                right: 37.5vw;
                top: 50.5vh;
                bottom: 24.5vh;
                display: flex;
            }

            .controls__row:nth-child(2) .controls__item:nth-child(3) .timer {
                left: 63.5vw;
                right: 11.5vw;
                top: 50.5vh;
                bottom: 24.5vh;
                display: flex;
            }

            .timer:active {
                transform: scale(0.95);
            }

            .timer__title {
                align-self: center;
                font-size: 10vh;
                text-align: center;
                transition: font-size ease-out 400ms;
                font-weight: 200;
                padding-bottom: 0.5%;
                position: relative;
            }

            .timer__close {
                position: absolute;
                top: 0;
                right: 0;
                width: 20vh;
                height: 20vh;
                color: #666;
                line-height: 20vh;
                font-size: 10vh;
                font-weight: 200;
                text-align: center;
                display: none;
                cursor: pointer;
                transition: color ease-in-out 200ms;
            }

            @keyframes timer-close-appear {
                0%, 50% {
                    color: #000;
                }

                70%, 100% {
                    color: #666;
                }
            }

            .timer_enabled {
                left: 0 !important;
                top: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                transition: all ease-out 400ms;
                z-index: 100;
                width: auto !important;
                height: auto !important;
                margin: 0 !important;
                transform: scale(1) !important;
                cursor: default;
            }

            .timer_enabled .timer__title {
                font-size: 40vh;
            }

            .timer_enabled .timer__close {
                display: block;
                animation: timer-close-appear 1s ease-out ;
            }

            .timer_overtime .timer__title:before {
                position: absolute;
                content: '−';
                right: 100%;
            }

            .timer_alert {
                background: red;
            }

        </style>
    </head>
    <body>
        <div class="container">
            <div class="controls">
                <div class="controls__row">
                    <div class="controls__item">
                        <div class="timer">
                            <div class="timer__title">02:00</div>
                            <div class="timer__close">×</div>
                        </div>
                    </div>
                    <div class="controls__item">
                        <div class="timer">
                            <div class="timer__title">05:00</div>
                            <div class="timer__close">×</div>
                        </div>
                    </div>
                    <div class="controls__item">
                        <div class="timer">
                            <div class="timer__title">07:00</div>
                            <div class="timer__close">×</div>
                        </div>
                    </div>
                </div>
                <div class="controls__row">
                    <div class="controls__item">
                        <div class="timer">
                            <div class="timer__title">10:00</div>
                            <div class="timer__close">×</div>
                        </div>
                    </div>
                    <div class="controls__item">
                        <div class="timer">
                            <div class="timer__title">15:00</div>
                            <div class="timer__close">×</div>
                        </div>
                    </div>
                    <div class="controls__item">
                        <div class="timer">
                            <div class="timer__title">20:00</div>
                            <div class="timer__close">×</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script type="text/javascript">
            var currentActiveTimer

            var items = document.getElementsByClassName("controls__item")
            Array.prototype.forEach.call(items, function (item) {

                var rect = item.getBoundingClientRect()
                var timer = item.getElementsByClassName('timer')[0]
                var timerTitle = timer.getElementsByClassName('timer__title')[0]
                var close = timer.getElementsByClassName('timer__close')[0]

                var closeEvent = close.addEventListener('click', function (e) {
                    e.preventDefault()
                    e.stopPropagation()

                    timer.closeTimer()
                })

                var clickEvent = timer.addEventListener('click', function () {
                    if (this.className.indexOf('timer_enabled') > -1) {
                        return
                    }

                    this.starting = true

                    currentActiveTimer = this
                    this.className = this.className + ' timer_enabled'

                    if (!this.defaultTimerText) {
                        this.defaultTimerText = timerTitle.innerText
                    }
                    var duration = parseInt(this.defaultTimerText.match(/[\d]+/)[0], 10)

                    setTimeout(function () {
                        this.starting = false
                        var startTime = new Date()
                        var endTime = new Date(startTime.getTime())
                        endTime.setMinutes(endTime.getMinutes() + duration)

                        this.timeInterval = setInterval(function () {
                            var secs = (endTime - new Date()) / 1000
                            var date = new Date(2018, 1, 1)

                            if (secs >= 0) {
                                date.setSeconds(secs)
                            } else {
                                date.setSeconds((new Date() - endTime) / 1000)
                            }

                            if (secs < 0 && !this.overTimeEnabled) {
                                this.overTimeEnabled = true

                                this.className += ' timer_overtime'
                            }

                            if (secs <= 60 && !this.minuteAlertEnabled) {
                                this.minuteAlertEnabled = true

                                this.style.backgroundColor = '#ff0000'
                                setTimeout(function () {
                                    this.style.backgroundColor = null
                                }.bind(this), 500)
                            }

                            if (secs < 30 && !this.alertModeEnabled) {
                                this.alertModeEnabled = true

                                this.className += ' timer_alert'
                            }

                            timerTitle.innerHTML = date.toISOString().substr(14, 5)
                        }.bind(this), 100)
                    }.bind(this), 500)

                    // setTimeout(function () {
                    //     if (!window.fullScreenEnabled) {
                    //         window.fullScreenEnabled = true
                    //         requestFullScreen(document.documentElement)
                    //     }
                    // }, 300)

                    this.closeTimer = function () {
                        if (this.starting) {
                            setTimeout(this.closeTimer.bind(this), 500)
                        } else {
                            this.overTimeEnabled = false
                            this.minuteAlertEnabled = false
                            this.alertModeEnabled = false

                            clearInterval(this.timeInterval)
                            this.className = 'timer'

                            setTimeout(function () {
                                var title = this.getElementsByClassName('timer__title')[0]
                                title.innerHTML = this.defaultTimerText
                            }.bind(this), 400)
                        }
                    }
                })
            })

            document.body.addEventListener('keyup', function (e) {
                if (e.keyCode === 27) { // escape
                    currentActiveTimer.closeTimer()
                    return false
                }
            })

            function requestFullScreen(element) {
                (element.requestFullScreen || element.webkitRequestFullScreen || element.mozRequestFullScreen || element.msRequestFullScreen).call(element);
            }
        </script>
    </body>
</html>
